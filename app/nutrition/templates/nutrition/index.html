<!DOCTYPE html> <html>
<head>
    <link rel="stylesheet" href="{{ url_for('static', filename='nutrition.css') }}">
	    <title>Nutrition Log - {{ user.username }}</title>
	    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
	    <script src="{{ url_for('static', filename='js/nutrition_chart.js') }}"></script>
	    </head>
	    <style>
		body {
		    font-family: Arial, sans-serif;
		    padding: 10px;
		    font-size: 24px;
		}

		h1, h2 {
		    font-size: 2.4em;
		    margin-bottom: 15px;
		}


		h3.chart-heading {
		    font-size: 1.2em;
		    margin-bottom: 10px;
		}

		a {
		    display: inline-block;
		    margin-bottom: 25px;
		    font-size: 1.6em;
		}

		.nutrition-summary p {
		    font-size: 1.5em;
		    margin: 5px 0;
		}

		canvas {
		    width: 100% !important; /* make charts full width */
		    height: auto !important;
		    margin-top: 20px;
		}

		/* Expand main container on desktop */
		.main-container {
		    max-width: 1200px; /* wider for desktop */
		    margin: 0 auto;
		    padding: 10px;
		}

		/* Table styling */
		.table-container {
		    max-width: 800px; /* wider table */
		    margin: 30px auto 0 auto;
		}

		table {
		    width: 100%;
		    border-collapse: collapse;
		    font-size: 1.4rem;
		    min-width: 300px;
		}

		th, td {
		    padding: 6px 10px;
		    border-bottom: 1px solid #ccc;
		    text-align: left;
		}

		th {
		    background-color: #eee;
		    font-weight: bold;
		}

		.btn-delete-entry {
		    display: inline-block;
		    padding: 8px 12px;
		    font-size: 1.1rem;
		    border-radius: 5px;
		    text-decoration: none;
		    background-color: #6c757d;
		    color: white;
		}

		.btn-delete-entry:hover {
		    background-color: #5a6268;
		}

		.btn-add-entry, .btn-reports, .btn-settings {
		    display: inline-block;
		    padding: 8px 14px;
		    font-size: 1.1rem;
		    border-radius: 5px;
		    text-decoration: none;
		    background-color: #007bff;
		    color: white;
		}

		.btn-add-entry:hover,
		.btn-reports:hover,
		.btn-settings:hover {
		    background-color: #0056b3;
		}

		/* Bigger charts */
		.chart-container {
		    width: 100%;
		    height: 700px; /* taller charts */
		    margin-top: 30px;
		}

		@media (max-width: 600px) {
		    body {
			font-size: 18px;
			padding: 5px;
		    }

		    h1 {
			font-size: 2.8em;
		    }
		    h3 {
			font-size: 2.0em;
		    }

		    h3.chart-heading {
			font-size: 1.5em;
		    }

		    a, .btn-delete-entry, .btn-add-entry, .btn-reports, .btn-settings {
			font-size: 1.2rem;
			padding: 6px 10px;
		    }

		    .chart-container {
			height: 450px; /* taller on mobile too */
		    }

		    .main-container {
			padding: 0;
			margin: 0;
			width: 100%;
		    }
		}
	    </style>

	<body>
	<div class="main-container">

    <h3>{{ user.username|capitalize }}'s Nutrition Log</h3>

    <a href="{{ url_for('nutrition.add_entry', username=user.username) }}" class="btn-add-entry">Add New Entry</a>

    <!-- Top Panel -->
    <div class="nutrition-summary">
        <p>Calories: {{ calendar_total_calories }} / {{ calories.current_target }}</p>
        <p style="color: {{ 'red' if calories.current_deficit < 0 else 'green' }};">
            {{ cal_deficit|int }} kcal
            {% if calories.current_deficit < 0 %}
                &#x25BC;
                {{ calories.target_catchup_time.strftime("%H:%M") if calories.target_catchup_time else "" }}
            {% else %}
                &#x25B2;
            {% endif %}
        </p>
        <p>Protein: {{ calendar_total_protein }}g</p>
        <p>Fiber: {{ calendar_total_fiber }}g</p>
    </div>

    <!-- Calories Chart -->
    <div class="chart-container">
        <canvas id="calorieChart"></canvas>
    </div>

    <!-- Entries Table -->
    <div class="table-container">
        <table>
            <thead>
                <tr><th></th><th></th><th></th></tr>
            </thead>
            <tbody>
                {% for entry in entries %}
                <tr>
                    <td>{{ entry.timestamp.strftime('%H:%M') }}</td>
                    <td>{{ entry.food.name[:20] }}</td>
                    <td>{{ entry.calories|int }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <div style="text-align: right; margin-top: 8px;">
            <a href="{{ url_for('nutrition.delete_entries', username=user.username) }}" class="btn-delete-entry">
                Edit / Delete Entries
            </a>
        </div>
    </div>

    <!-- Protein & Fiber Charts -->
    <div class="chart-container">
        <canvas id="proteinChart"></canvas>
    </div>

    <div class="chart-container">
        <canvas id="fiberChart"></canvas>
    </div>

    <a href="{{ url_for('nutrition.reports', username=user.username) }}" class="btn-reports">Reports</a>
    <a href="{{ url_for('nutrition.settings', username=user.username) }}" class="btn-settings">User Settings</a>
    <br><br><br>

    <!-- Chart Data for JS -->
    <script>
        const chartData = {
            labels: {{ chart_labels|tojson }},
            actual: {{ calories.actual|tojson }},
            target: {{ calories.target|tojson }},
            projected: {{ calories.projected|tojson }},
            yesterday: {{ yesterday_calories.actual|tojson }}
        };
        const proteinData = {
            labels: {{ chart_labels|tojson }},
            actual: {{ protein.actual|tojson }},
            target: {{ protein.target|tojson }},
            projected: {{ protein.projected|tojson }},
            yesterday: {{ yesterday_protein.actual|tojson }}
        };
        const fiberData = {
            labels: {{ chart_labels|tojson }},
            actual: {{ fiber.actual|tojson }},
            target: {{ fiber.target|tojson }},
            projected: {{ fiber.projected|tojson }},
            yesterday: {{ yesterday_fiber.actual|tojson }}
        };
    </script>
</div>
</body>
</html>
